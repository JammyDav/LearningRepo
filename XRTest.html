<!DOCTYPE html>
<html>
<head>
    <title>WebXR Ball Throw (Dual Hand)</title>
    <meta name="description" content="An interactive WebXR experience where you can throw balls with either VR controller.">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- A-Frame Core: The main library for creating WebXR scenes -->
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <!-- A-Frame Physics System: Adds physics capabilities like gravity and collisions -->
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-physics-system@v4.2.2/dist/aframe-physics-system.min.js"></script>
</head>
<body>
    <!-- The a-scene component is the root of all A-Frame entities.
         We enable the physics system here and set a global gravity. -->
    <a-scene physics="driver: local; gravity: 0 -9.8 0;">

        <!-- =================================================
             ASSETS - Pre-load textures for better performance 
             ================================================= -->
        <a-assets>
            <img id="groundTexture" src="https://cdn.jsdelivr.net/gh/aframevr/aframe-registry@master/assets/images/textures/wood.jpg" crossorigin="anonymous">
            <img id="skyTexture" src="https://cdn.aframe.io/a-painter/images/sky.jpg" crossorigin="anonymous">
        </a-assets>

        <!-- =================================================
             ENVIRONMENT
             ================================================= -->
        <!-- Ground Plane -->
        <a-plane 
            static-body 
            position="0 0 -4" 
            rotation="-90 0 0" 
            width="30" 
            height="30" 
            src="#groundTexture" 
            repeat="10 10">
        </a-plane>

        <!-- Background Sky -->
        <a-sky src="#skyTexture"></a-sky>

        <!-- Lighting -->
        <a-light type="ambient" color="#444"></a-light>
        <a-light type="directional" position="-1 1 2" color="#FFF"></a-light>


        <!-- =================================================
             PLAYER AND CONTROLLERS (UPDATED)
             ================================================= -->
        <a-entity id="rig" position="0 1.6 0">
            <a-camera></a-camera>
            
            <!-- Left Hand Controller -->
            <a-entity id="leftHand" oculus-touch-controls="hand: left"></a-entity>
            
            <!-- Right Hand Controller -->
            <a-entity id="rightHand" oculus-touch-controls="hand: right"></a-entity>
        </a-entity>

    </a-scene>

    <!-- =================================================
         JAVASCRIPT LOGIC (UPDATED)
         ================================================= -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const sceneEl = document.querySelector('a-scene');
            const leftHand = document.getElementById('leftHand');
            const rightHand = document.getElementById('rightHand');

            // --- Generic function to handle ball throwing for EITHER hand ---
            // It now accepts the controller element ('handEl') as an argument.
            function throwBall(handEl) {
                // 1. Create a new ball (a-sphere) entity dynamically.
                const ball = document.createElement('a-sphere');
                
                // 2. Set its visual properties.
                ball.setAttribute('radius', 0.1);
                // Give it a random hex color!
                ball.setAttribute('color', `#${Math.random().toString(16).slice(2, 8).toUpperCase()}`);
                
                // 3. Make it a physical object.
                ball.setAttribute('dynamic-body', {
                    shape: 'sphere',
                    mass: 0.15 // A bit of weight.
                });

                // 4. Position the ball at the controller's location.
                const controllerPos = new THREE.Vector3();
                // Use the passed-in hand element ('handEl') to get the world position.
                handEl.object3D.getWorldPosition(controllerPos);
                ball.setAttribute('position', controllerPos);

                // 5. Calculate the launch velocity based on the controller's direction.
                const controllerDir = new THREE.Vector3();
                // Use the passed-in hand element ('handEl') to get the world direction.
                handEl.object3D.getWorldDirection(controllerDir);
                
                // We must wait for the physics body to be initialized before applying forces.
                ball.addEventListener('body-loaded', function () {
                    const force = 10; // The power of the throw.
                    // The direction vector points "out of the back" of the controller, so we negate it to shoot forward.
                    const velocity = controllerDir.multiplyScalar(-force); 
                    
                    // Apply the calculated velocity to the ball's physics body.
                    ball.body.velocity.set(velocity.x, velocity.y, velocity.z);
                });
                
                // 6. Add the newly created ball to the scene.
                sceneEl.appendChild(ball);

                // 7. Optional: Remove the ball after some time to keep the scene clean.
                setTimeout(() => {
                    if (ball.parentNode) {
                        ball.parentNode.removeChild(ball);
                    }
                }, 10000); // Remove after 10 seconds.
            }

            // --- Event Listeners for BOTH controllers ---
            // We add a listener to each hand. Note the use of an arrow function 
            // to pass the correct controller element into our generic throwBall function.
            leftHand.addEventListener('triggerdown', () => throwBall(leftHand));
            rightHand.addEventListener('triggerdown', () => throwBall(rightHand));
        });
    </script>
</body>
</html>
